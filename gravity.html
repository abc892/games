<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gravity Ball Game</title>
<style>
  body { margin:0; background:black; overflow:hidden; }
  canvas { display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// ---------------- CONSTANTS ----------------
const G = 0.15;
const keys = {};
const thrust = 0.1;
const miniMap = { width:200, height:150, padding:10 };
const starSectorSize = 400;

// ---------------- PLAYER ----------------
const player = { x:canvas.width/2, y:canvas.height/2, vx:0, vy:0, angle:0, radius:8 };

// ---------------- RANDOM PLANETS ----------------
const colors = ["orange","red","green","blue","purple","yellow","pink","cyan","lime","magenta"];
const planets = [];

// Function to generate non-intersecting planets
function generatePlanets(num){
  let attempts = 0;
  while(planets.length < num && attempts < 1000){
    attempts++;
    const radius = 30 + Math.random()*90; // 30-120
    const x = Math.random()*3000 - 1500;
    const y = Math.random()*3000 - 1500;
    const color = colors[Math.floor(Math.random()*colors.length)];

    let ok = true;
    for(let p of planets){
      const dx = x - p.x;
      const dy = y - p.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < radius + p.radius + 50){ ok = false; break; }
    }
    const d0 = Math.sqrt(x*x + y*y);
    if(d0 < 200) ok=false;

    if(ok) planets.push({
      x,
      y,
      radius,
      mass: Math.pow(radius,3)*0.07, // <-- mass proportional to r^3
      color
    });
  }
}
generatePlanets(10);

// ---------------- BLACK HOLE ----------------
let blackHole;
function generateBlackHole(){
  let ok = false;
  while(!ok){
    const x = Math.random()*6000 - 3000;
    const y = Math.random()*6000 - 3000;
    const dist = Math.sqrt((x-player.x)**2 + (y-player.y)**2);
    if(dist > 4000){
      blackHole = { x, y, radius:100, mass:800000, color:"black", angle:0, particles:[] };
      // Initialize particles for swirling effect
      for(let i=0;i<100;i++){
        blackHole.particles.push({
          r: blackHole.radius + Math.random()*150,
          angle: Math.random()*Math.PI*2,
          speed: 0.002 + Math.random()*0.004,
          size: 1 + Math.random()*2
        });
      }
      ok=true;
    }
  }
}
generateBlackHole();

// ---------------- INPUT ----------------
window.addEventListener("keydown", e=>keys[e.key]=true);
window.addEventListener("keyup", e=>keys[e.key]=false);

// ---------------- PHYSICS ----------------
function applyGravity(){
  for(let p of planets.concat([blackHole])){
    let dx = p.x - player.x;
    let dy = p.y - player.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < 0.1) dist = 0.1;

    const R = p.radius + player.radius;
    const nx = dx / dist;
    const ny = dy / dist;

    let accel = dist > R ? G*p.mass/(dist*dist) : G*p.mass*dist/(R*R*R);
    player.vx += accel*nx;
    player.vy += accel*ny;

    // collision removed for black hole so player passes through
    if(dist < R && p !== blackHole){
      player.x = p.x - nx*R;
      player.y = p.y - ny*R;
      const vDotN = player.vx*nx + player.vy*ny;
      if(vDotN > 0){ player.vx -= vDotN*nx; player.vy -= vDotN*ny; }
    }
  }
}

function updatePlayer(){
  if(keys["ArrowLeft"]) player.angle-=0.05;
  if(keys["ArrowRight"]) player.angle+=0.05;
  if(keys["ArrowUp"]){ player.vx+=Math.cos(player.angle)*thrust; player.vy+=Math.sin(player.angle)*thrust; }
  if(keys["m"]){ player.vx*=0.98; player.vy*=0.98; }
  applyGravity();
  player.x+=player.vx; player.y+=player.vy;
}

// ---------------- INFINITE STARFIELD ----------------
function drawStars(){
  const centerX=canvas.width/2;
  const centerY=canvas.height/2;
  const startX=Math.floor((player.x-canvas.width/2)/starSectorSize)*starSectorSize;
  const startY=Math.floor((player.y-canvas.height/2)/starSectorSize)*starSectorSize;
  const endX=Math.floor((player.x+canvas.width/2)/starSectorSize)*starSectorSize;
  const endY=Math.floor((player.y+canvas.height/2)/starSectorSize)*starSectorSize;

  for(let sx=startX; sx<=endX; sx+=starSectorSize){
    for(let sy=startY; sy<=endY; sy+=starSectorSize){
      const seed = sx*73856093 ^ sy*19349663;
      const rand = mulberry32(seed);
      const starsInSector = 10 + Math.floor(rand()*15);
      for(let i=0;i<starsInSector;i++){
        const starX = sx + rand()*starSectorSize;
        const starY = sy + rand()*starSectorSize;
        const radius = 0.5 + rand()*1.5;
        const brightness = 0.2 + rand()*0.5;
        const screenX = starX - player.x + centerX;
        const screenY = starY - player.y + centerY;
        if(screenX>=0 && screenX<=canvas.width && screenY>=0 && screenY<=canvas.height){
          ctx.fillStyle=`rgba(255,255,255,${brightness})`;
          ctx.beginPath();
          ctx.arc(screenX,screenY,radius,0,Math.PI*2);
          ctx.fill();
        }
      }
    }
  }
}

function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;let t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return ((t^t>>>14)>>>0)/4294967296;}}

// ---------------- DRAW ----------------
function drawPlayer(){
  const centerX=canvas.width/2;
  const centerY=canvas.height/2;
  ctx.save();
  ctx.translate(centerX,centerY);
  ctx.rotate(player.angle);
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(0,0,player.radius,0,Math.PI*2);
  ctx.fill();
  ctx.strokeStyle="cyan";
  ctx.beginPath();
  ctx.moveTo(0,0); ctx.lineTo(15,0); ctx.stroke();
  ctx.restore();
}

function drawPlanets(){
  const centerX=canvas.width/2;
  const centerY=canvas.height/2;
  for(let p of planets){
    const screenX=p.x-player.x+centerX;
    const screenY=p.y-player.y+centerY;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(screenX,screenY,p.radius,0,Math.PI*2);
    ctx.fill();
  }

  // ---------------- BLACK HOLE VISUALS ----------------
  const bhX = blackHole.x - player.x + centerX;
  const bhY = blackHole.y - player.y + centerY;

  // Accretion disk arcs
  blackHole.angle += 0.005;
  for(let i=0;i<5;i++){
    ctx.strokeStyle = `rgba(150,0,200,${0.1-i*0.015})`;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(bhX,bhY,blackHole.radius*(1.2+i*0.3),blackHole.angle,blackHole.angle+Math.PI*1.5);
    ctx.stroke();
  }

  // Warp glow
  const gradient = ctx.createRadialGradient(bhX,bhY,blackHole.radius*0.5,bhX,bhY,blackHole.radius*3);
  gradient.addColorStop(0,"rgba(0,0,0,1)");
  gradient.addColorStop(0.3,"rgba(50,0,50,0.3)");
  gradient.addColorStop(1,"rgba(0,0,0,0)");
  ctx.fillStyle = gradient;
  ctx.beginPath();
  ctx.arc(bhX,bhY,blackHole.radius*3,0,Math.PI*2);
  ctx.fill();

  // Core
  ctx.fillStyle = blackHole.color;
  ctx.beginPath();
  ctx.arc(bhX,bhY,blackHole.radius,0,Math.PI*2);
  ctx.fill();

  // ---------------- BLACK HOLE PARTICLES ----------------
  for(let p of blackHole.particles){
    p.angle += p.speed;
    const px = bhX + Math.cos(p.angle)*p.r;
    const py = bhY + Math.sin(p.angle)*p.r;
    ctx.fillStyle = `rgba(200,50,250,0.3)`; // vibrant particle
    ctx.beginPath();
    ctx.arc(px,py,p.size,0,Math.PI*2);
    ctx.fill();
  }
}

// ---------------- MINI-MAP ----------------
function drawMiniMap(){
  const mapX=canvas.width-miniMap.width-miniMap.padding;
  const mapY=miniMap.padding;
  ctx.fillStyle="rgba(0,0,0,0.5)";
  ctx.fillRect(mapX,mapY,miniMap.width,miniMap.height);
  ctx.strokeStyle="white";
  ctx.strokeRect(mapX,mapY,miniMap.width,miniMap.height);

  let maxDist=0;
  for(let p of planets.concat([blackHole])){
    const d=Math.sqrt((p.x-player.x)**2+(p.y-player.y)**2)+p.radius;
    if(d>maxDist) maxDist=d;
  }
  if(maxDist<200) maxDist=200;
  const scale=(miniMap.width/2)/maxDist;

  // Draw planets
  for(let p of planets){
    const dx=p.x-player.x;
    const dy=p.y-player.y;
    const px=mapX+miniMap.width/2+dx*scale;
    const py=mapY+miniMap.height/2+dy*scale;
    const r=Math.max(2,p.radius*scale);
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(px,py,r,0,Math.PI*2);
    ctx.fill();
  }

  // Black hole on map (barely visible)
  const dx=blackHole.x-player.x;
  const dy=blackHole.y-player.y;
  const px=mapX+miniMap.width/2+dx*scale;
  const py=mapY+miniMap.height/2+dy*scale;
  const r=Math.max(2,blackHole.radius*scale);
  ctx.fillStyle="rgba(180,180,180,0.15)";
  ctx.beginPath();
  ctx.arc(px,py,r,0,Math.PI*2);
  ctx.fill();

  // Player
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(mapX+miniMap.width/2,mapY+miniMap.height/2,4,0,Math.PI*2);
  ctx.fill();
}

// ---------------- GAME LOOP ----------------
function loop(){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  drawStars();
  updatePlayer();
  drawPlanets();
  drawPlayer();
  drawMiniMap();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
