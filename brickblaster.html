<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Brick Blaster</title>
  <style>
    body { margin:0; display:flex; align-items:center; justify-content:center; height:100vh; background:#111; color:#fff; font-family:sans-serif; overflow:hidden; }
    #wrap { text-align:center; position:relative; }
    canvas { background:#000; border:2px solid #444; border-radius:8px; display:none; margin:auto; }
    #info { margin-top:10px; font-size:18px; }
    #overlay { position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.8); color:#fff; font-size:24px; flex-direction:column; visibility:hidden; }
    #overlay button { margin:10px; padding:10px 20px; font-size:18px; cursor:pointer; border:none; border-radius:6px; background:#0ff; color:#000; font-weight:bold; }
    #settings { position:absolute; top:0; left:0; right:0; bottom:0; background:#000; color:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; }
    select, button { padding:10px; margin:10px; font-size:16px; border-radius:6px; border:none; }
    #homeBtn { position:absolute; top:10px; left:10px; background:#0ff; color:#000; padding:8px 14px; font-weight:bold; border-radius:6px; border:none; cursor:pointer; }
  </style>
</head>
<body>
  <div id="wrap">
    <button id="homeBtn" onclick="goHome()">Home</button>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="info">Lives: <span id="lives">3</span> | Score: <span id="score">0</span> | Time: <span id="time">0</span>s</div>
    <div id="overlay">
      <div id="message"></div>
      <div>
        <button id="retryBtn">Retry</button>
        <button id="settingsBtn">Settings</button>
        <button id="homePageBtn">Home</button>
      </div>
    </div>
    <div id="settings">
      <h2>Brick Blaster Settings</h2>
      <label>Difficulty (Ball Speed): </label>
      <select id="speedSelect">
        <option value="1">1 (Slow)</option>
        <option value="2">2 (Medium)</option>
        <option value="3">3 (Fast)</option>
      </select>
      <label>Bricks Mode:</label>
      <select id="brickSelect">
        <option value="12">12 Bricks (4x3)</option>
        <option value="24">24 Bricks (6x4)</option>
        <option value="48">48 Bricks (8x6)</option>
        <option value="endless">Endless Mode</option>
      </select>
      <button id="startBtn">Start Game</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');
    const message = document.getElementById('message');
    const settingsDiv = document.getElementById('settings');
    const speedSelect = document.getElementById('speedSelect');
    const brickSelect = document.getElementById('brickSelect');
    const homeBtn = document.getElementById('homeBtn');
    const retryBtn = document.getElementById('retryBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const homePageBtn = document.getElementById('homePageBtn');
    const livesEl = document.getElementById('lives');
    const scoreEl = document.getElementById('score');
    const timeEl = document.getElementById('time');

    let x, y, dx, dy, paddleX, rightPressed, leftPressed, lives, score, timer, intervalId;
    let brickRowCount, brickColumnCount, brickWidth, brickHeight, brickPadding, brickOffsetTop;
    let brickGrid, endlessMode = false, spawnInterval;
    const paddleHeight = 10;
    let paddleWidth = 75, ballRadius = 8;

    function goHome(){ window.location.href='index.html'; }

    function initBricks() {
      brickGrid = [];
      let totalBricks = brickRowCount * brickColumnCount;
      for (let c = 0; c < brickColumnCount; c++) {
        brickGrid[c] = [];
        for (let r = 0; r < brickRowCount; r++) {
          brickGrid[c][r] = { x:0, y:0, status:1 };
        }
      }
    }

    function setupBricksGrid(cols, rows) {
      brickColumnCount = cols;
      brickRowCount = rows;
      brickPadding = 0;
      brickWidth = canvas.width / cols;
      brickHeight = 20;
      brickOffsetTop = 0;
      initBricks();
    }

    function startGame() {
      settingsDiv.style.display = 'none';
      canvas.style.display = 'block';
      overlay.style.visibility = 'hidden';

      let speed = parseInt(speedSelect.value);
      endlessMode = brickSelect.value === 'endless';
      if (brickSelect.value === '12') setupBricksGrid(4,3);
      else if (brickSelect.value === '24') setupBricksGrid(6,4);
      else setupBricksGrid(8,6);

      if (brickSelect.value === '12'){ paddleWidth=100; ballRadius=10; }
      else if (brickSelect.value === '24'){ paddleWidth=85; ballRadius=9; }
      else { paddleWidth=70; ballRadius=8; }

      x = canvas.width / 2;
      y = canvas.height - 30;
      let angle = (Math.random()*Math.PI/3)+(Math.PI/6);
      dx = speed * Math.cos(angle);
      dy = -speed * Math.sin(angle);
      paddleX = (canvas.width - paddleWidth) / 2;
      rightPressed = leftPressed = false;
      lives = 3; score = 0; timer = 0;
      livesEl.textContent = lives;
      scoreEl.textContent = score;
      timeEl.textContent = timer;

      clearInterval(intervalId);
      intervalId = setInterval(()=>{timer++; timeEl.textContent=timer;},1000);

      if(endlessMode){
        clearInterval(spawnInterval);
        spawnInterval = setInterval(spawnNewBrick,3000);
      }

      countdown(3, draw);
    }

    function countdown(n, cb){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle='#0ff';
      ctx.font='60px Arial';
      ctx.textAlign='center';
      ctx.textBaseline='middle';
      function tick(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if(n>0){
          ctx.fillText(n,canvas.width/2,canvas.height/2);
          n--; setTimeout(tick,1000);
        } else cb();
      }
      tick();
    }

    function drawBricks(){
      for(let c=0;c<brickColumnCount;c++){
        for(let r=0;r<brickRowCount;r++){
          let b=brickGrid[c][r];
          if(b.status==1){
            let brickX = c*(brickWidth+brickPadding);
            let brickY = brickOffsetTop + r*(brickHeight+brickPadding);
            b.x = brickX; b.y = brickY;
            ctx.beginPath();
            ctx.rect(brickX, brickY, brickWidth, brickHeight);
            ctx.fillStyle = '#f33';
            ctx.fill();
            ctx.closePath();
          }
        }
      }
    }

    function spawnNewBrick(){
      if(!endlessMode) return;
      let emptyCells = [];
      for(let c=0;c<brickColumnCount;c++){
        for(let r=0;r<Math.min(brickRowCount+6,Math.floor(canvas.height/brickHeight)-2);r++){
          if(!brickGrid[c]) brickGrid[c]=[];
          if(!brickGrid[c][r] || brickGrid[c][r].status!==1) emptyCells.push({c,r});
        }
      }
      if(emptyCells.length>0){
        let cell = emptyCells[Math.floor(Math.random()*emptyCells.length)];
        if(!brickGrid[cell.c]) brickGrid[cell.c]=[];
        brickGrid[cell.c][cell.r]={x:0,y:0,status:1};
      }
    }

    function drawBall(){ ctx.beginPath(); ctx.arc(x,y,ballRadius,0,Math.PI*2); ctx.fillStyle='#0ff'; ctx.fill(); ctx.closePath(); }
    function drawPaddle(){ ctx.beginPath(); ctx.rect(paddleX,canvas.height-paddleHeight,paddleWidth,paddleHeight); ctx.fillStyle='#0f0'; ctx.fill(); ctx.closePath(); }

    function collisionDetection(){
      for(let c=0;c<brickColumnCount;c++){
        for(let r=0;r<brickRowCount;r++){
          let b=brickGrid[c][r];
          if(b && b.status==1){
            if(x> b.x && x<b.x+brickWidth && y>b.y && y<b.y+brickHeight){
              dy=-dy; b.status=0; score++; scoreEl.textContent=score;
              if(!endlessMode && score==brickRowCount*brickColumnCount){ endGame('YOU WIN!'); }
            }
          }
        }
      }
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawBricks(); drawBall(); drawPaddle(); collisionDetection();

      if(x+dx>canvas.width-ballRadius||x+dx<ballRadius) dx=-dx;
      if(y+dy<ballRadius) dy=-dy; else if(y+dy>canvas.height-ballRadius){
        if(x>paddleX&&x<paddleX+paddleWidth){ dy=-dy; }
        else{
          lives--; livesEl.textContent=lives;
          if(!lives){ endGame('GAME OVER'); return; }
          else{ x=canvas.width/2; y=canvas.height-30; dy=-Math.abs(dy); }
        }
      }

      if(rightPressed&&paddleX<canvas.width-paddleWidth) paddleX+=5;
      else if(leftPressed&&paddleX>0) paddleX-=5;

      x+=dx; y+=dy; requestAnimationFrame(draw);
    }

    function endGame(msg){
      clearInterval(intervalId);
      if(endlessMode) clearInterval(spawnInterval);
      overlay.style.visibility='visible';
      message.textContent=`${msg} | Score: ${score} | Time: ${timer}s`;
    }

    document.addEventListener('keydown',e=>{
      if(e.key==='Right'||e.key==='ArrowRight') rightPressed=true;
      else if(e.key==='Left'||e.key==='ArrowLeft') leftPressed=true;
      else if(e.key==='f'||e.key==='F') toggleFullscreen();
      else if(e.key===' '&&overlay.style.visibility==='visible'){ startGame(); }
    });
    document.addEventListener('keyup',e=>{
      if(e.key==='Right'||e.key==='ArrowRight') rightPressed=false;
      else if(e.key==='Left'||e.key==='ArrowLeft') leftPressed=false;
    });

    retryBtn.onclick=()=>startGame();
    settingsBtn.onclick=()=>{ overlay.style.visibility='hidden'; settingsDiv.style.display='flex'; canvas.style.display='none'; };
    homePageBtn.onclick=()=>goHome();

    document.getElementById('startBtn').onclick=startGame;

    function toggleFullscreen(){
      if(!document.fullscreenElement){
        if(canvas.requestFullscreen) canvas.requestFullscreen();
      } else { document.exitFullscreen(); }
    }
  </script>
</body>
</html>
