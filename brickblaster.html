<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brick Blaster</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    canvas {
      background: #000;
      display: none;
      border: 2px solid #fff;
    }
    #settings, #endScreen, #countdown {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: rgba(0,0,0,0.8);
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      background: #ff9800;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
    }
    button:hover { background: #e68900; }
    #homeBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 8px 14px;
      background: #ff9800;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    #homeBtn:hover { background: #e68900; }
  </style>
</head>
<body>
  <button id="homeBtn" onclick="location.href='index.html'">üè† Home</button>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <!-- Settings -->
  <div id="settings">
    <h1>Brick Blaster</h1>
    <label>Ball Speed:
      <select id="speedSelect">
        <option value="3">1 (Slow)</option>
        <option value="5">2 (Medium)</option>
        <option value="7">3 (Fast)</option>
      </select>
    </label><br/><br/>
    <label>Mode:
      <select id="brickSelect">
        <option value="12">1 (12 Bricks - 4x3)</option>
        <option value="24">2 (24 Bricks - 6x4)</option>
        <option value="48">3 (48 Bricks - 8x6)</option>
        <option value="endless">4 (Endless Mode)</option>
      </select>
    </label><br/><br/>
    <button onclick="startCountdown()">Start Game</button>
  </div>

  <!-- Countdown -->
  <div id="countdown" style="display:none;">
    <h1 id="countNum">3</h1>
  </div>

  <!-- End Screen -->
  <div id="endScreen" style="display:none;">
    <h1 id="endMsg"></h1>
    <p id="finalStats"></p>
    <button onclick="restartGame()">Replay</button>
    <p>(Press SPACE to replay or F to toggle fullscreen)</p>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let ballX, ballY, ballDX, ballDY, ballSpeed;
    let paddleX, paddleWidth=100, paddleHeight=10;
    let rightPressed=false, leftPressed=false;
    let bricks=[], brickRows, brickCols;
    let brickWidth, brickHeight=20, brickPadding=2;
    let score=0, lives=3, timer=0, gameRunning=false, endless=false;
    let gameInterval, timerInterval;

    document.addEventListener("keydown", e=>{
      if(e.key==="ArrowRight") rightPressed=true;
      if(e.key==="ArrowLeft") leftPressed=true;
      if(e.code==="Space" && !gameRunning) restartGame();
      if(e.key.toLowerCase()==='f') toggleFullscreen();
    });
    document.addEventListener("keyup", e=>{
      if(e.key==="ArrowRight") rightPressed=false;
      if(e.key==="ArrowLeft") leftPressed=false;
    });

    function toggleFullscreen(){
      if(!document.fullscreenElement){
        canvas.requestFullscreen().catch(()=>{});
      } else {
        document.exitFullscreen();
      }
    }

    function randomAngle(){
      // Tilted but not too straight; ensure decent x/y ratio
      let angle = (Math.random()*0.6 + 0.2)*Math.PI; // 36¬∞‚Äì108¬∞
      if(Math.abs(Math.cos(angle)) < 0.3) angle = 0.3*Math.sign(Math.cos(angle)); 
      return angle;
    }

    function initGame(){
      score=0; lives=3; timer=0;
      ballX=canvas.width/2; ballY=canvas.height-30;
      let angle=randomAngle();
      ballDX=ballSpeed*Math.cos(angle);
      ballDY=-Math.abs(ballSpeed*Math.sin(angle));
      paddleX=(canvas.width-paddleWidth)/2;

      let selected=document.getElementById("brickSelect").value;
      endless=(selected==="endless");
      let totalBricks=endless?24:parseInt(selected);
      brickCols=Math.sqrt(totalBricks);
      brickRows=totalBricks/brickCols;
      brickWidth=(canvas.width-(brickCols-1)*brickPadding)/brickCols;

      bricks=[];
      for(let c=0;c<brickCols;c++){
        bricks[c]=[];
        for(let r=0;r<brickRows;r++){
          bricks[c][r]={x:0,y:0,status:1};
        }
      }
    }

    function drawBricks(){
      for(let c=0;c<brickCols;c++){
        for(let r=0;r<brickRows;r++){
          if(bricks[c][r].status==1){
            let x=c*(brickWidth+brickPadding);
            let y=r*(brickHeight+brickPadding);
            bricks[c][r].x=x;
            bricks[c][r].y=y;
            ctx.fillStyle="#ff5722";
            ctx.fillRect(x,y,brickWidth,brickHeight);
          }
        }
      }
    }

    function drawBall(){
      ctx.beginPath();
      ctx.arc(ballX,ballY,10,0,Math.PI*2);
      ctx.fillStyle="#00f";
      ctx.fill();
      ctx.closePath();
    }

    function drawPaddle(){
      ctx.fillStyle="#0095DD";
      ctx.fillRect(paddleX,canvas.height-paddleHeight-10,paddleWidth,paddleHeight);
    }

    function drawScore(){
      ctx.fillStyle="#fff";
      ctx.font="16px Arial";
      ctx.fillText("Score: "+score,8,20);
      ctx.fillText("Lives: "+lives,100,20);
      ctx.fillText("Time: "+timer+"s",200,20);
    }

    function collisionDetection(){
      for(let c=0;c<brickCols;c++){
        for(let r=0;r<brickRows;r++){
          let b=bricks[c][r];
          if(b.status==1){
            if(ballX>b.x && ballX<b.x+brickWidth && ballY>b.y && ballY<b.y+brickHeight){
              ballDY=-ballDY;
              b.status=0; score++;
              if(checkWin()){
                if(endless){
                  resetBricks();
                } else {
                  endGame("You Win!");
                }
              }
            }
          }
        }
      }
    }

    function checkWin(){
      for(let c=0;c<brickCols;c++){
        for(let r=0;r<brickRows;r++){
          if(bricks[c][r].status==1) return false;
        }
      }
      return true;
    }

    function resetBricks(){
      for(let c=0;c<brickCols;c++){
        for(let r=0;r<brickRows;r++){
          bricks[c][r].status=1;
        }
      }
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawBricks(); drawBall(); drawPaddle(); drawScore(); collisionDetection();

      if(ballX+ballDX>canvas.width-10 || ballX+ballDX<10) ballDX=-ballDX;
      if(ballY+ballDY<10) ballDY=-ballDY;
      else if(ballY+ballDY>canvas.height-20){
        if(ballX>paddleX && ballX<paddleX+paddleWidth) ballDY=-ballDY;
        else{
          lives--;
          if(!lives) endGame("Game Over");
          else resetBall();
        }
      }

      ballX+=ballDX; ballY+=ballDY;
      if(rightPressed && paddleX<canvas.width-paddleWidth) paddleX+=7;
      else if(leftPressed && paddleX>0) paddleX-=7;
    }

    function resetBall(){
      ballX=canvas.width/2; ballY=canvas.height-30;
      let angle=randomAngle();
      ballDX=ballSpeed*Math.cos(angle);
      ballDY=-Math.abs(ballSpeed*Math.sin(angle));
      paddleX=(canvas.width-paddleWidth)/2;
    }

    function endGame(msg){
      clearInterval(gameInterval);
      clearInterval(timerInterval);
      gameRunning=false;
      document.getElementById("finalStats").textContent=`Score: ${score} | Time Played: ${timer}s`;
      document.getElementById("endMsg").textContent=msg;
      document.getElementById("endScreen").style.display="flex";
      canvas.style.display="none";
    }

    function restartGame(){
      document.getElementById("endScreen").style.display="none";
      startCountdown();
    }

    function startCountdown(){
      document.getElementById("settings").style.display="none";
      canvas.style.display="none";
      let count=3;
      document.getElementById("countdown").style.display="flex";
      document.getElementById("countNum").textContent=count;
      let countdown=setInterval(()=>{
        count--;
        if(count<=0){
          clearInterval(countdown);
          document.getElementById("countdown").style.display="none";
          startGame();
        } else document.getElementById("countNum").textContent=count;
      },1000);
    }

    function startGame(){
      canvas.style.display="block";
      ballSpeed=parseInt(document.getElementById("speedSelect").value);
      initGame();
      gameRunning=true;
      gameInterval=setInterval(draw,16);
      timerInterval=setInterval(()=>{if(gameRunning)timer++;},1000);
    }
  </script>
</body>
</html>
