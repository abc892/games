<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brick Blaster</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    canvas {
      background: #000;
      display: block;
      border: 2px solid #fff;
    }
    #overlay, #settings, #endScreen, #countdown {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: rgba(0,0,0,0.8);
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      background: #ff9800;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
    }
    button:hover { background: #e68900; }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <!-- Settings screen -->
  <div id="settings">
    <h1>Brick Blaster</h1>
    <label>Ball Speed:
      <select id="speedSelect">
        <option value="3">1 (Slow)</option>
        <option value="5">2 (Medium)</option>
        <option value="7">3 (Fast)</option>
      </select>
    </label>
    <br/><br/>
    <label>Bricks:
      <select id="brickSelect">
        <option value="12">1 (12 Bricks - 4x3)</option>
        <option value="24">2 (24 Bricks - 6x4)</option>
        <option value="48">3 (48 Bricks - 8x6)</option>
      </select>
    </label>
    <br/><br/>
    <button onclick="startCountdown()">Start Game</button>
    <button onclick="location.href='index.html'">üè† Home</button>
  </div>

  <!-- Countdown -->
  <div id="countdown" style="display:none;">
    <h1 id="countNum">3</h1>
  </div>

  <!-- End screen -->
  <div id="endScreen" style="display:none;">
    <h1 id="endMsg"></h1>
    <p id="finalStats"></p>
    <button onclick="restartGame()">Replay</button>
    <button onclick="location.href='index.html'">üè† Home</button>
    <p>(Or press SPACE to replay)</p>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let ballX, ballY, ballDX, ballDY, ballSpeed;
    let paddleX, paddleWidth = 100, paddleHeight = 10;
    let rightPressed = false, leftPressed = false;
    let bricks = [], brickRowCount, brickColumnCount;
    let brickWidth, brickHeight = 20, brickPadding = 10, brickOffsetTop = 50, brickOffsetLeft = 30;
    let score, lives, timer, gameInterval;
    let gameRunning = false;

    document.addEventListener("keydown", e => {
      if (e.key === "Right" || e.key === "ArrowRight") rightPressed = true;
      if (e.key === "Left" || e.key === "ArrowLeft") leftPressed = true;
      if (e.code === "Space" && !gameRunning) restartGame();
    });
    document.addEventListener("keyup", e => {
      if (e.key === "Right" || e.key === "ArrowRight") rightPressed = false;
      if (e.key === "Left" || e.key === "ArrowLeft") leftPressed = false;
    });

    function initGame() {
      score = 0;
      lives = 3;
      timer = 0;
      paddleX = (canvas.width - paddleWidth) / 2;
      ballX = canvas.width / 2;
      ballY = canvas.height - 30;
      // Random direction tilted towards bricks
      let angle = (Math.random() * 0.5 + 0.25) * Math.PI; // between 45¬∞‚Äì135¬∞
      ballDX = ballSpeed * Math.cos(angle);
      ballDY = -Math.abs(ballSpeed * Math.sin(angle));

      // Setup bricks
      bricks = [];
      let totalBricks = parseInt(document.getElementById("brickSelect").value);
      brickColumnCount = Math.sqrt(totalBricks);
      brickRowCount = totalBricks / brickColumnCount;
      brickWidth = (canvas.width - brickOffsetLeft*2 - (brickColumnCount-1)*brickPadding) / brickColumnCount;

      for(let c=0; c<brickColumnCount; c++){
        bricks[c] = [];
        for(let r=0; r<brickRowCount; r++){
          bricks[c][r] = { x:0, y:0, status:1 };
        }
      }
    }

    function drawBricks() {
      for(let c=0; c<brickColumnCount; c++){
        for(let r=0; r<brickRowCount; r++){
          if(bricks[c][r].status==1){
            let brickX = c*(brickWidth+brickPadding)+brickOffsetLeft;
            let brickY = r*(brickHeight+brickPadding)+brickOffsetTop;
            bricks[c][r].x = brickX;
            bricks[c][r].y = brickY;
            ctx.fillStyle = "#ff5722";
            ctx.fillRect(brickX, brickY, brickWidth, brickHeight);
          }
        }
      }
    }

    function collisionDetection() {
      for(let c=0; c<brickColumnCount; c++){
        for(let r=0; r<brickRowCount; r++){
          let b = bricks[c][r];
          if(b.status==1){
            if(ballX> b.x && ballX< b.x+brickWidth && ballY> b.y && ballY< b.y+brickHeight){
              ballDY = -ballDY;
              b.status=0;
              score++;
              if(score==brickRowCount*brickColumnCount){
                endGame("You Win!");
              }
            }
          }
        }
      }
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(ballX, ballY, 10, 0, Math.PI*2);
      ctx.fillStyle = "#00f";
      ctx.fill();
      ctx.closePath();
    }

    function drawPaddle() {
      ctx.fillStyle = "#0095DD";
      ctx.fillRect(paddleX, canvas.height-paddleHeight-10, paddleWidth, paddleHeight);
    }

    function drawScore() {
      ctx.fillStyle = "#fff";
      ctx.fillText("Score: "+score, 8, 20);
      ctx.fillText("Lives: "+lives, 100, 20);
      ctx.fillText("Time: "+timer+"s", 200, 20);
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawBricks();
      drawBall();
      drawPaddle();
      drawScore();
      collisionDetection();

      if(ballX+ballDX>canvas.width-10 || ballX+ballDX<10){ ballDX=-ballDX; }
      if(ballY+ballDY<10){ ballDY=-ballDY; }
      else if(ballY+ballDY>canvas.height-20){
        if(ballX>paddleX && ballX<paddleX+paddleWidth){ ballDY=-ballDY; }
        else {
          lives--;
          if(!lives) endGame("Game Over");
          else {
            ballX=canvas.width/2; ballY=canvas.height-30;
            let angle=(Math.random()*0.5+0.25)*Math.PI;
            ballDX=ballSpeed*Math.cos(angle);
            ballDY=-Math.abs(ballSpeed*Math.sin(angle));
            paddleX=(canvas.width-paddleWidth)/2;
          }
        }
      }

      ballX+=ballDX; ballY+=ballDY;
      if(rightPressed && paddleX<canvas.width-paddleWidth) paddleX+=7;
      else if(leftPressed && paddleX>0) paddleX-=7;
    }

    function gameLoop(){ draw(); }

    function endGame(msg) {
      clearInterval(gameInterval);
      gameRunning=false;
      document.getElementById("endMsg").textContent=msg;
      document.getElementById("finalStats").textContent="Score: "+score+" | Time: "+timer+"s";
      document.getElementById("endScreen").style.display="flex";
    }

    function restartGame() {
      document.getElementById("endScreen").style.display="none";
      startCountdown();
    }

    function startCountdown() {
      document.getElementById("settings").style.display="none";
      let c=3;
      document.getElementById("countdown").style.display="flex";
      document.getElementById("countNum").textContent=c;
      let countdown=setInterval(()=>{
        c--;
        if(c<=0){
          clearInterval(countdown);
          document.getElementById("countdown").style.display="none";
          startGame();
        } else {
          document.getElementById("countNum").textContent=c;
        }
      },1000);
    }

    function startGame() {
      ballSpeed=parseInt(document.getElementById("speedSelect").value);
      initGame();
      gameRunning=true;
      gameInterval=setInterval(gameLoop,16);
      setInterval(()=>{ if(gameRunning) timer++; },1000);
    }
  </script>
</body>
</html>
