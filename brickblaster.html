<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brick Blaster</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #settings {
      margin-top: 50px;
    }
    .option {
      margin: 10px;
    }
    #gameCanvas {
      display: none;
      background: #000;
      margin: 20px auto;
      border: 2px solid #fff;
      display: block;
    }
    #countdown {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 100px;
      font-weight: bold;
      color: yellow;
      display: none;
    }
    #overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: rgba(0,0,0,0.8);
      color: white;
      font-size: 30px;
      display: none;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .start-btn { background: #0077cc; color: white; }
    .home-btn { background: #444; color: white; }
  </style>
</head>
<body>

  <div id="settings">
    <h1>üß± Brick Blaster</h1>
    <p>Choose difficulty before starting:</p>
    <div class="option">
      <label>Ball Speed:</label>
      <select id="speedSelect">
        <option value="3">1 (Slow)</option>
        <option value="5">2 (Medium)</option>
        <option value="7">3 (Fast)</option>
      </select>
    </div>
    <div class="option">
      <label>No. of Bricks:</label>
      <select id="brickSelect">
        <option value="12">1 (12 Bricks)</option>
        <option value="24">2 (24 Bricks)</option>
        <option value="48">3 (48 Bricks)</option>
      </select>
    </div>
    <button class="start-btn" onclick="startGame()">Start Game</button>
    <br>
    <button class="home-btn" onclick="location.href='index.html'">üè† Home</button>
  </div>

  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <div id="countdown">3</div>
  <div id="overlay"></div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const countdownEl = document.getElementById("countdown");
    const overlay = document.getElementById("overlay");

    let ballSpeed = 3;
    let brickCount = 12;
    let paddleHeight = 10, paddleWidth = 80, paddleX;
    let rightPressed = false, leftPressed = false;

    let x, y, dx, dy, ballRadius = 8;
    let bricks = [];
    let brickRowCount, brickColumnCount, brickWidth, brickHeight = 20, brickPadding = 10, brickOffsetTop = 30, brickOffsetLeft = 30;
    let score, lives, timer, interval;

    function startGame() {
      // Get settings
      ballSpeed = parseInt(document.getElementById("speedSelect").value);
      brickCount = parseInt(document.getElementById("brickSelect").value);

      // Setup bricks layout
      if (brickCount === 12) { brickRowCount = 3; brickColumnCount = 4; }
      else if (brickCount === 24) { brickRowCount = 4; brickColumnCount = 6; }
      else { brickRowCount = 6; brickColumnCount = 8; }
      brickWidth = (canvas.width - brickOffsetLeft*2 - (brickColumnCount-1)*brickPadding) / brickColumnCount;

      // Setup ball/paddle
      paddleX = (canvas.width - paddleWidth)/2;
      x = canvas.width/2;
      y = canvas.height-30;

      // Random angle upwards
      let angle = (Math.random() * Math.PI/2) + Math.PI/4; 
      dx = ballSpeed * Math.cos(angle);
      dy = -ballSpeed * Math.sin(angle);

      // Setup bricks array
      bricks = [];
      for(let c=0;c<brickColumnCount;c++) {
        bricks[c] = [];
        for(let r=0;r<brickRowCount;r++) {
          bricks[c][r] = { x: 0, y: 0, status: 1 };
        }
      }

      score = 0;
      lives = 3;
      timer = 60;

      // Switch screen
      document.getElementById("settings").style.display = "none";
      canvas.style.display = "block";

      // Countdown
      let count = 3;
      countdownEl.style.display = "block";
      countdownEl.textContent = count;
      const cdInterval = setInterval(()=>{
        count--;
        if(count===0){
          countdownEl.textContent = "GO!";
        } else if(count<0){
          clearInterval(cdInterval);
          countdownEl.style.display = "none";
          startLoop();
        } else {
          countdownEl.textContent = count;
        }
      },1000);
    }

    function startLoop() {
      document.addEventListener("keydown", keyDownHandler, false);
      document.addEventListener("keyup", keyUpHandler, false);

      interval = setInterval(draw, 10);

      // Timer countdown
      setInterval(()=>{
        if(timer>0){
          timer--;
        }
      },1000);
    }

    function keyDownHandler(e) {
      if(e.key==="Right" || e.key==="ArrowRight") rightPressed=true;
      else if(e.key==="Left" || e.key==="ArrowLeft") leftPressed=true;
      else if(e.code==="Space" && overlay.style.display==="flex") restartGame();
    }
    function keyUpHandler(e) {
      if(e.key==="Right" || e.key==="ArrowRight") rightPressed=false;
      else if(e.key==="Left" || e.key==="ArrowLeft") leftPressed=false;
    }

    function collisionDetection() {
      for(let c=0;c<brickColumnCount;c++) {
        for(let r=0;r<brickRowCount;r++) {
          let b=bricks[c][r];
          if(b.status===1) {
            if(x> b.x && x< b.x+brickWidth && y> b.y && y< b.y+brickHeight) {
              dy=-dy;
              b.status=0;
              score++;
              if(score===brickRowCount*brickColumnCount) endGame(true);
            }
          }
        }
      }
    }

    function drawBricks() {
      for(let c=0;c<brickColumnCount;c++) {
        for(let r=0;r<brickRowCount;r++) {
          if(bricks[c][r].status===1) {
            let brickX=(c*(brickWidth+brickPadding))+brickOffsetLeft;
            let brickY=(r*(brickHeight+brickPadding))+brickOffsetTop;
            bricks[c][r].x=brickX;
            bricks[c][r].y=brickY;
            ctx.beginPath();
            ctx.rect(brickX, brickY, brickWidth, brickHeight);
            ctx.fillStyle="orange";
            ctx.fill();
            ctx.closePath();
          }
        }
      }
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(x,y,ballRadius,0,Math.PI*2);
      ctx.fillStyle="yellow";
      ctx.fill();
      ctx.closePath();
    }

    function drawPaddle() {
      ctx.beginPath();
      ctx.rect(paddleX, canvas.height-paddleHeight, paddleWidth, paddleHeight);
      ctx.fillStyle="#00f";
      ctx.fill();
      ctx.closePath();
    }

    function drawHUD() {
      ctx.font="16px Arial";
      ctx.fillStyle="#fff";
      ctx.fillText("Score: "+score,8,20);
      ctx.fillText("Lives: "+lives,canvas.width-65,20);
      ctx.fillText("Time: "+timer,canvas.width/2-30,20);
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawBricks();
      drawBall();
      drawPaddle();
      drawHUD();
      collisionDetection();

      if(x+dx>canvas.width-ballRadius || x+dx<ballRadius) dx=-dx;
      if(y+dy<ballRadius) dy=-dy;
      else if(y+dy>canvas.height-ballRadius){
        if(x>paddleX && x<paddleX+paddleWidth) dy=-dy;
        else {
          lives--;
          if(!lives) { endGame(false); return; }
          else { x=canvas.width/2; y=canvas.height-30; dx=ballSpeed; dy=-ballSpeed; paddleX=(canvas.width-paddleWidth)/2; }
        }
      }

      if(rightPressed && paddleX<canvas.width-paddleWidth) paddleX+=7;
      else if(leftPressed && paddleX>0) paddleX-=7;

      if(timer<=0) { endGame(false); return; }

      x+=dx;
      y+=dy;
    }

    function endGame(win) {
      clearInterval(interval);
      overlay.style.display="flex";
      overlay.innerHTML = `
        <h2>${win?"üéâ You Win!":"üíÄ Game Over"}</h2>
        <p>Score: ${score}</p>
        <button onclick="restartGame()">Retry</button>
        <button onclick="location.href='index.html'">üè† Home</button>
      `;
    }

    function restartGame() {
      overlay.style.display="none";
      canvas.style.display="none";
      document.getElementById("settings").style.display="block";
    }
  </script>
</body>
</html>
